<% layout("layout/boilerplate") %>


    <div class="container">
        <!-- ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ± -->
        <div class="card shadow-sm h-100 mb-4">
            <div class="card-body">
                <h1>
                    <%= event.title %>
                </h1>
                <h2>å€™è£œæ—¥æœŸé–“: <%= event.startDate.toLocaleDateString() %>ã€œ<%= event.endDate.toLocaleDateString() %>
                </h2>
            </div>
            <div class="card-body">
                <h3>æ‹›å¾…ã‚³ãƒ¼ãƒ‰</h3>
                <p>ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦ã€ã‚¤ãƒ™ãƒ³ãƒˆã«å‚åŠ ã§ãã¾ã™</p>
                <code><%= event.eventCode %></code>
            </div>
            <div class="card-body">
                <h2>å‚åŠ è€…ä¸€è¦§ (<%= event.members.length %>äºº)</h2>
                <ul>
                    <% event.members.forEach(member=> { %>
                        <li>
                            <%= member.user.username %>
                        </li>
                        <% }) %>
                </ul>
                <%# ã‚‚ã—å‚åŠ è€…ãŒã„ãªã„å ´åˆ %>
                    <% if (event.members.length===0) { %>
                        <p>ã¾ã å‚åŠ è€…ã¯ã„ã¾ã›ã‚“ã€‚</p>
                        <% } %>
            </div>
        </div>

        <!-- å¯èƒ½æ—¥è¨­å®šãƒœã‚¿ãƒ³ -->
        <div class="management-actions">
            <a href="/events/<%= event._id %>/selectDate" class="btn btn-primary">å¯èƒ½æ—¥ã®è¨­å®šã‚’ã™ã‚‹</a>
        </div>

        <!-- å€™è£œæ—¥åˆ†æçµæœ -->
        <div class="results-container">
            <h2>å€™è£œæ—¥</h2>
            <!-- å…¨å“¡å¯èƒ½ãªå€™è£œæ—¥ -->
            <div class="match-section">
                <h3>ğŸ‰å…¨å“¡OK!</h3>
                <ul>
                    <% for(let day of perfectMatchDays) { %>
                        <li>
                            <%= day.date.toLocaleDateString('ja-JP', { month: 'long' , day: 'numeric' , weekday: 'short' })%>
                            <span> (<%= day.weather %> / æœ€é«˜: <%= day.maxTemp %>â„ƒ, æœ€ä½: <%= day.minTemp %>â„ƒ)</span>
                        </li>
                        <% } %>
                </ul>
            </div>
            <!-- ã‚ã¨ä¸€äººã®å€™è£œæ—¥ -->
            <div class="match-section">
                <h3>ğŸ¤”ã‚ã¨ä¸€äºº!</h3>
                <ul class="semi-match-card">
                    <% for(let day of semiMatchDays) { %>
                        <li>
                            <%= day.date.toLocaleDateString('ja-JP', { month: 'long' , day: 'numeric' , weekday: 'short' })%>
                            <span> (<%= day.weather %> / æœ€é«˜: <%= day.maxTemp %>â„ƒ, æœ€ä½: <%= day.minTemp %>â„ƒ)</span>
                        </li>
                        <% } %>
                </ul>
            </div>
        </div>

        <div class="container">
            <h2>ç›®çš„åœ°</h2>
            <% if (event.place.lat && event.place.lon) { %>
                <p><%= event.place.placeName %></p>
                <div id="map"></div>
                <style>
                    #map {
                        position: static;
                        height: 400px;
                        width: 100%;
                    }
                </style>
                <script>
                    const eventPlace = <%- JSON.stringify(event.place) %>;
                    const addressStrings = eventPlace.placeName.split(",");
                    const key = '7Eu3N8auWE8CJAA6fd2M';
        
                    const map = L.map('map').setView([eventPlace.lat, eventPlace.lon], 15);
        
                    const mtLayer = L.maptiler.maptilerLayer({
                        apiKey: key,
                        style: L.maptiler.MapStyle.STREETS,
                    }).addTo(map);
        
                    L.marker([eventPlace.lat, eventPlace.lon]).addTo(map)
                        .bindPopup(`<b>${addressStrings[0]}</b>`) // ãƒ”ãƒ³ã«åå‰ã‚’è¡¨ç¤º
                        .openPopup();
                </script>
            <% } else if (event.place.placeName) { %>
                <p><%= event.place.placeName %></p>
            <% } else { %>
                <p>ç›®çš„åœ°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“</p>
            <% } %>
        </div>


        <!-- å‰Šé™¤ãƒ•ã‚©ãƒ¼ãƒ ã¨æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
        <div class="bottom-actions">
            <form action="/events/<%= event._id %>?_method=DELETE" method="post">
                <button type="submit" class="btn btn-danger">ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‰Šé™¤ã™ã‚‹</button>
            </form>
            <a href="/events" class="btn btn-secondary">æˆ»ã‚‹</a>
        </div>



    </div>